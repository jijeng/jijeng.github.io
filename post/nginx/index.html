<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>nginx 学习记录 - Jijeng&#39;s Blog</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="jijeng" /><meta name="description" content="介绍和使用nginx 的记录
" /><meta name="keywords" content="Hugo, theme, even" />






<meta name="generator" content="Hugo 0.79.1 with theme even" />


<link rel="canonical" href="http://jijeng.github.io/post/nginx/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.c7bc1becf36bcf6a9ebd25d2947e43a2eb745ddb0c9a32b43126fd7fa460c351.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="nginx 学习记录" />
<meta property="og:description" content="介绍和使用nginx 的记录" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://jijeng.github.io/post/nginx/" />
<meta property="article:published_time" content="2020-01-07T15:32:29+08:00" />
<meta property="article:modified_time" content="2020-01-07T15:32:29+08:00" />
<meta itemprop="name" content="nginx 学习记录">
<meta itemprop="description" content="介绍和使用nginx 的记录">
<meta itemprop="datePublished" content="2020-01-07T15:32:29+08:00" />
<meta itemprop="dateModified" content="2020-01-07T15:32:29+08:00" />
<meta itemprop="wordCount" content="6762">



<meta itemprop="keywords" content="nginx," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="nginx 学习记录"/>
<meta name="twitter:description" content="介绍和使用nginx 的记录"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Jijeng&#39;s Blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Jijeng&#39;s Blog</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">nginx 学习记录</h1>

      <div class="post-meta">
        <span class="post-time"> 2020-01-07 </span>
        
          <span class="more-meta"> 约 6762 字 </span>
          <span class="more-meta"> 预计阅读 14 分钟 </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#概念">概念</a>
          <ul>
            <li><a href="#功能">功能</a></li>
          </ul>
        </li>
        <li><a href="#实战">实战</a>
          <ul>
            <li><a href="#在阿里云-ubuntu-机器上搭建-nginx">在阿里云 Ubuntu 机器上搭建 nginx</a></li>
            <li><a href="#nginx-实现上传功能">nginx 实现上传功能</a></li>
            <li><a href="#常用的命令">常用的命令</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>介绍和使用nginx 的记录</p>
<p>Nginx同Apache一样都是一种WEB服务器。Apache的发展时期很长，而且是毫无争议的世界第一大服务器。它有着很多优点：稳定、开源、跨平台等等。Apache 是一个重量级、高并发的服务器，在运行并发程序的时候，会消耗服务器大量内存。这导致了 Apache不可能成为高性能web 服务器。</p>
<p>轻量级高并发服务器Nginx就应运而生了。由于 Nginx 有以下特点：</p>
<ul>
<li>Nginx使用基于事件驱动架构，使得其可以支持数以百万级别的TCP连接</li>
<li>高度的模块化和自由软件许可证使得第三方模块层出不穷（这是个开源的时代啊~）</li>
<li>Nginx是一个跨平台服务器，可以运行在Linux，Windows，FreeBSD，Solaris，AIX，Mac OS等操作系统上</li>
</ul>
<p>这些优秀的设计带来的是极大的稳定性。</p>
<h2 id="概念">概念</h2>
<h3 id="功能">功能</h3>
<p>nginx主要是做转发</p>
<p>（1）反向代理（Reverse Proxy）：</p>
<p>maybe是使用最多的用途。</p>
<p>反向代理（Reverse Proxy）方式是指以代理服务器来接受internet上的连接请求，然后将请求转发给内部网络上的服务器，并将从服务器上得到的结果返回给internet上请求连接的客户端，此时代理服务器对外就表现为一个反向代理服务器。简单来说就是真实的服务器不能直接被外部网络访问，所以需要一台代理服务器，而代理服务器能被外部网络访问的同时又跟真实服务器在同一个网络环境，当然也可能是同一台服务器，端口不同而已。</p>
<p>客户端是无感知代理的存在的，反向代理对外都是透明的，访问者并不知道自己访问的是一个代理。因为客户端不需要任何配置就可以访问。</p>
<p>反向代理，&ldquo;它代理的是服务端，代服务端接收请求&rdquo;，主要用于服务器集群分布式部署的情况下，反向代理隐藏了服务器的信息。</p>
<p>反向代理的作用：
（1）保证内网的安全，通常将反向代理作为公网访问地址，Web服务器是内网
（2）负载均衡，通过反向代理服务器来优化网站的负载</p>
<p>反向代理的意思是以代理服务器（这里也就是nginx）来接收网络上的请求，也就是url（默认是80端口），</p>
<p>1，nginx通过对url里面的一些判断(转达规则配置在nginx配置文件中），比如端口号（nginx默认是80）有可能是对二级域名来判断
比如test1.baidu.com,test2.baidu.com,这就是两个二级域名，这里的一级域名也就是baidu.com,DNS会将这两个域名都解析到同一个ip（需要添加二级域名解析才行（阿里云需要在域名解析中添加解析即可，不同的域名，可解析到统一ip的服务器上），也可以分别解析到不同ip）
2，nginx配置反向代理后可以将不同二级域名的请求转发到不同的可以提供相应服务的端口或者ip和端口</p>
<p>（2）负载均衡</p>
<p>这里提到的客户端发送的、Nginx反向代理服务器接收到的请求数量，就是我们说的负载量。请求数量按照一定的规则进行分发到不同的服务器处理的规则，就是一种均衡规则。所以，将服务器接收到的请求按照规则分发的过程，称为负载均衡。</p>
<p>负载均衡也是Nginx常用的一个功能，负载均衡其意思就是分摊到多个操作单元上进行执行。简单而言就是当有2台或以上服务器时，根据规则随机的将请求分发到指定的服务器上处理，负载均衡配置一般都需要同时配置反向代理，通过反向代理跳转到负载均衡。Nginx支持的负载均衡调度算法方式如下：</p>
<p>weight轮询(默认，常用)：接收到的请求按照权重分配到不同的后端服务器，即使在使用过程中，某一台后端服务器宕机，Nginx会自动将该服务器剔除出队列，请求受理情况不会受到任何影响。 这种方式下，可以给不同的后端服务器设置一个权重值(weight)，用于调整不同的服务器上请求的分配率；权重数据越大，被分配到请求的几率越大；该权重值，主要是针对实际工作环境中不同的后端服务器硬件配置进行调整的。
ip_hash（常用）：每个请求按照发起客户端的ip的hash结果进行匹配，这样的算法下一个固定ip地址的客户端总会访问到同一个后端服务器，这也在一定程度上解决了集群部署环境下session共享的问题。
fair：智能调整调度算法，动态的根据后端服务器的请求处理到响应的时间进行均衡分配，响应时间短处理效率高的服务器分配到请求的概率高，响应时间长处理效率低的服务器分配到的请求少；结合了前两者的优点的一种调度算法。但是需要注意的是Nginx默认不支持fair算法，如果要使用这种调度算法，请安装upstream_fair模块。
url_hash：按照访问的url的hash结果分配请求，每个请求的url会指向后端固定的某个服务器，可以在Nginx作为静态服务器的情况下提高缓存效率。同样要注意Nginx默认不支持这种调度算法，要使用的话需要安装Nginx的hash软件包。</p>
<p>（3）http 服务器</p>
<p>Nginx本身也是一个静态资源的服务器，当只有静态资源的时候，就可以使用Nginx来做服务器，同时现在也很流行动静分离，就可以通过Nginx来实现。</p>
<p>如果一个网站只是静态页面的话，那么就可以通过这种方式来实现部署。</p>
<p>动静分离是让动态网站里的动态网页根据一定规则把不变的资源和经常变的资源区分开来，动静资源做好了拆分以后，我们就可以根据静态资源的特点将其做缓存操作，这就是网站静态化处理的核心思路。</p>
<p>（4）正向代理</p>
<p>正向代理，意思是一个位于客户端和原始服务器(origin server)之间的服务器，为了从原始服务器取得内容，客户端向代理发送一个请求并指定目标(原始服务器)，然后代理向原始服务器转交请求并将获得的内容返回给客户端。客户端才能使用正向代理。当你需要把你的服务器作为代理服务器的时候，可以用Nginx来实现正向代理。</p>
<p>正向代理最大的特点是客户端非常明确要访问的服务器地址；服务器只清楚请求来自哪个代理服务器，而不清楚来自哪个具体的客户端；正向代理模式屏蔽或者隐藏了真实客户端信息</p>
<p>客户端必须设置正向代理服务器，当然前提是要知道正向代理服务器的IP地址，还有代理程序的端口。</p>
<p>总结来说：正向代理，&ldquo;它代理的是客户端，代客户端发出请求&rdquo;</p>
<p>正向代理和反向代理的区别：1、正向代理：类似我们想要访问国外的Google服务器，但是由于访问限制，我们需要找一个代理去访问。换句话说，客户端明确知道要访问的服务器的地址，客户端把请求发送给代理，代理转发给服务器，服务器把响应传给代理，最后代理把响应传给客户端。我们可以看到客户端知道服务器是谁，但是服务器并不知道客户端是谁，这就是正向代理，隐藏了客户端的真实信息。2、反向代理：类似我们访问淘宝，由于访问量巨大，淘宝会使用许多台服务器（就是分布式服务器）来支持，但是每个客户端的请求到底由哪一台服务器来响应，我们需要一个代理来决定。换句话说，客户端并不知道要把请求发送给哪一台服务器，但是知道发送给哪一个代理，然后代理依据规则（响应时间，负载均衡等）决定把请求转发给哪一台服务器。可以看到，客户端并不知道他访问的服务器是谁，这就是反向代理，隐藏了服务器的真实信息。</p>
<p>正向代理的用途：</p>
<ul>
<li>访问原来无法访问的资源，如Google</li>
<li>可以做缓存，加速访问资源</li>
<li>对客户端访问授权，上网进行认证</li>
<li>代理可以记录用户访问记录（上网行为管理），对外隐藏用户信息</li>
</ul>
<p><img src="https://ftp.bmp.ovh/imgs/2020/02/63f15d3496180b3b.png" alt=""></p>
<p>在正向代理中，Proxy和Client同属于一个LAN（图中方框内），隐藏了客户端信息；</p>
<p>在反向代理中，Proxy和Server同属于一个LAN（图中方框内），隐藏了服务端信息；</p>
<p>其他</p>
<p>Nginx是支持热启动的，也就是说当我们修改配置文件后，不用关闭Nginx，就可以实现让配置生效</p>
<p>Nginx是一款轻量级的HTTP服务器，采用事件驱动的异步非阻塞处理方式框架，这让 其具有极好的IO性能，时常用于服务端的反向代理和负载均衡</p>
<p>在Nginx上部署静态网站项目</p>
<p><a href="https://juejin.im/post/5c2496046fb9a049d13231ba">如何将自己的网站部署到阿里云的服务器</a></p>
<p>echo &ldquo;&lt;!doctype html&gt;<head>&lt;meta http-equiv=&ldquo;Content-Type&quot;content=&ldquo;text/html; charset=utf-8&rdquo; /&gt;</head><body><p>恭喜你，部署静态项目成功啦~~~</p></body></html>&rdquo; &gt; index.html</p>
<h2 id="实战">实战</h2>
<h3 id="在阿里云-ubuntu-机器上搭建-nginx">在阿里云 Ubuntu 机器上搭建 nginx</h3>
<p>一： 安装软件</p>
<p>（下面的yum 是 centos 的命令，在 Ubuntu 中需要安装对应的软件，但是使用不同的命令）</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">dpkg -l <span class="p">|</span> grep zlib
</code></pre></td></tr></table>
</div>
</div><p>1 SSL功能需要openssl库，直接通过yum安装: #yum install openssl</p>
<p>2 gzip模块需要zlib库，直接通过yum安装: #yum install zlib</p>
<p>3 rewrite模块需要pcre库，直接通过yum安装: #yum install pcre</p>
<p><a href="https://blog.csdn.net/z920954494/article/details/52132125">https://blog.csdn.net/z920954494/article/details/52132125</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">server {
        listen 80 default_server;            #监听端口，将来访问的端口
        listen [::]:80 default_server;

        root /var/www/html;

        # Add index.php to the list if you are using PHP
        index index.html index.htm index.nginx-debian.html;


        server_name _;

        location / {
                include uwsgi_params;
                uwsgi_pass 127.0.0.1:8000;    #uwsgi中配置的路径
        }

        location /static {
                alias /apps/xxx/static;       #静态资源路径
        }

        location /resume.ico  {
                alias /apps/xxx/static/resume.ico;    #网页图标路径
        }
}
</code></pre></td></tr></table>
</div>
</div><p>安装的结构</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">Ubuntu安装之后的文件结构大致为：
    1）所有的配置文件都在/etc/nginx下，并且每个虚拟主机已经安排在了/etc/nginx/sites-available下

    2）程序文件在/usr/sbin/nginx

    3）日志放在了/var/log/nginx中

    4）并已经在/etc/init.d/下创建了启动脚本nginx

    5）默认的虚拟主机的目录设置在了/var/www/nginx-default (有的版本默认的虚拟主机的目录设置在了/var/www, 请参考/etc/nginx/sites-available里的配置)
</code></pre></td></tr></table>
</div>
</div><p>二：配置 nginx</p>
<p>安装成了之后，需要开启相应的服务</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">service nginx start

systemctl status nginx.service


修改文件之后，使用这个进行语法的检查

Turns out I can test if the configuration file is OK with:
nginx -t -c /etc/nginx/nginx.conf

nginx -t -c /etc/nginx/nginx.conf



sudo rm /etc/nginx/sites-enabled/default
sudo service nginx restart
</code></pre></td></tr></table>
</div>
</div><p>报错原因：您已经有一个绑定到HTTP端口80的进程。您可以运行命令sudo lsof -i:80以使用该端口获取进程列表，然后停止/禁用Web服务器。
解决方案：您可以运行命令来停止使用端口80 sudo fuser -k 80 / tcp的进程</p>
<p>查看Nginx服务状态</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">service nginx status
</code></pre></td></tr></table>
</div>
</div><p>在Nginx运行时，会查找/etc/sites-enabled目录下的所有配置文件用于显示对应内容。完成新的配置时，需要重启服务器:</p>
<p>sudo service nginx reload</p>
<p>检测配置文件是否有错误</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">root@[ESC实例]:~# nginx -t
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful
</code></pre></td></tr></table>
</div>
</div><p>然后reload 一下， 重启nginx</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">sudo nginx -s reload
</code></pre></td></tr></table>
</div>
</div><p>重启nginx 服务</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">sudo systemctl restart nginx
</code></pre></td></tr></table>
</div>
</div><p>简单命令</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">    sudo service nginx start        <span class="c1">#启动</span>
    sudo service nginx stop         <span class="c1">#停止</span>
    sudo service nginx restart      <span class="c1">#重新启动</span>
    sudo service nginx reload       <span class="c1">#重新启动</span>
    sudo nginx -s start     <span class="c1">#启动</span>
    sudo nginx -s stop      <span class="c1">#停止</span>
    sudo nginx -s restart   <span class="c1">#重新启动</span>
    sudo nginx -s reload    <span class="c1">#重新加载配置</span>
</code></pre></td></tr></table>
</div>
</div><p>最新版本nginx配置是由4个文件构成：</p>
<ul>
<li>conf.d：用户自己定义的conf配置文件</li>
<li>sites-available：系统默认设置的配置文件</li>
<li>sites-enabled：由sites-available中的配置文件转换生成</li>
<li>nginx.conf：汇总以上三个配置文件的内容，同时配置我们所需要的参数</li>
</ul>
<p>sites-available 更像是一种资源文件夹， sites-enabled 是真正运行的文件夹，两者的关系是，  sites-enabled是  sites-available 编译之后的结果。</p>
<p>在 Nginx 的默认配置文件 nginx.conf 中，最后一行写着 include /etc/nginx/conf.d/*.conf;说明只要是该目录下文件后缀为 conf 的文件都会被自动加载到 Nginx 配置中</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">scp -r jeng@112.126.63.128:/home/jeng/notebook ./
ssh -oPort<span class="o">=</span><span class="m">6001</span> jeng@123.56.8.10
ssh -oPort<span class="o">=</span><span class="m">6001</span> peiyi@123.56.8.10
ssh -oPort<span class="o">=</span><span class="m">6001</span> root@123.56.8.10
ssh -oPort<span class="o">=</span><span class="m">6001</span> shichao@123.56.8.10

</code></pre></td></tr></table>
</div>
</div><p>112.126.63.128</p>
<p>卸载</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback"># 删除nginx，使用-purge 
sudo apt-get --purge remove nginx

# 移除全部不使用的软件
sudo apt-get autoremove

# 罗列和nginx 所有相关的软件，然后删除
dpkg --get-selections|grep nginx
sudo apt-get --purge remove nginx
sudo apt-get --purge remove nginx-common
sudo apt-get --purge remove nginx-core

# 查看nginx 正在运行的进程，如果有那么久kill 掉
ps -ef |grep nginx
sudo kill -9 XXX
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">最新版本nginx配置是由4个文件构成：

conf.d：用户自己定义的conf配置文件
sites-available：系统默认设置的配置文件
sites-enabled：由sites-available中的配置文件转换生成
nginx.conf：汇总以上三个配置文件的内容，同时配置我们所需要的参数
在部署需要的web服务时，我们可以拷贝sites-enabled中的default文件到conf.d并且修改名字为**.conf,然后进行配置
</code></pre></td></tr></table>
</div>
</div><p>多看看这里的例子的解释：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">server {
    #服务启动时监听的端口
    listen 80 default_server;
    listen [::]:80 default_server;
    #服务启动时文件加载的路径
    root /var/www/html/wordpress;
    #默认加载的第一个文件
    index index.php index.html index.htm index.nginx-debian.html;
    #页面访问域名，如果没有域名也可以填写_
    server_name www.xiexianbo.xin;

    location / {
        #页面加载失败后所跳转的页面
        try_files $uri $uri/ =404;
    }
    
      
    #以下配置只服务于php
    # 将PHP脚本传递给在127.0.0.1:9000上监听的FastCGI服务器
    location ~ \.php$ {
        include snippets/fastcgi-php.conf;
        # With php7.0-cgi alone:
        #fastcgi_pass 127.0.0.1:9000;
        # With php7.0-fpm:
        fastcgi_pass unix:/run/php/php7.0-fpm.sock;
    }

    # 如果Apache的文档为root，则拒绝访问.htaccess文件
    location ~ /\.ht {
        deny all;
    }
}
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">upstream drugHumanArchives { 
        server 127.0.0.1:8213 weight=1; 
    }
server {
        listen       8199;
        server_name  localhost;
    location / {
            root   /data/test/narcV3.1/front;
            index  index.html index.htm;
        }
        
        location /drugHumanArchives
        {
            proxy_set_header   Host             $host:8199;
            proxy_set_header   X-Real-IP        $remote_addr;
            proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
            proxy_cookie_path  /drugHumanArchives  /drugHumanArchives;
            proxy_set_header   Cookies          $http_cookies;
            proxy_pass http://drugHumanArchives/drugHumanArchives;
        }
}
</code></pre></td></tr></table>
</div>
</div><p>1）upstream 配置后端服务本来的访问路径</p>
<p>　　　2）server 配置代理端口  listen：统一端口号   server_name：域名</p>
<p>　　　　第一个location /   说明：访问http://10.196.10.50:8199/drugarchives   即可访问到服务器静态资源/data/test/narcV3.1/front/drugarchives /index..html</p>
<p>　　　　第二个location /drugHumanArchives  说明 proxy_pass  代理路径 http://drugHumanArchives/drugHumanArchives;  第一个drugHumanArchives代表上面配置的upstream ，即http://127.0.0.1:8213/drugHumanArchives;</p>
<p>　　　　　　访问http://10.196.10.50:8199/drugHumanArchives    即可代理到路径http://10.196.10.50:8213/drugHumanArchives</p>
<p>关于location 的问题</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">location = / {
# 精确匹配 / ，后面带任何字符串的地址都不符合
}

localtion /api {
# 匹配任何 /api 开头的URL，包括 /api 后面任意的, 比如 /api/getList
# 匹配符合以后，还要继续往下搜索
# 只有后面的正则表达式没有匹配到时，这一条才会采用这一条
}

localtion ~ /api/abc {
# 匹配任何 /api/abc 开头的URL，包括 /api/abc 后面任意的, 比如 /api/abc/getList
# 匹配符合以后，还要继续往下搜索
# 只有后面的正则表达式没有匹配到时，这一条才会采用这一条
}
以/ 通用匹配, 如果没有其它匹配,任何请求都会匹配到
=开头表示精确匹配
如 A 中只匹配根目录结尾的请求，后面不能带任何字符串。
^~ 开头表示uri以某个常规字符串开头，不是正则匹配
~ 开头表示区分大小写的正则匹配;
~* 开头表示不区分大小写的正则匹配
</code></pre></td></tr></table>
</div>
</div><p><a href="https://link.juejin.im/?target=https%3A%2F%2Fsegmentfault.com%2Fa%2F1190000002797606">nginx配置location总结及rewrite规则写法</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">配置nginx权限和静态文件统一
编辑nginx配置文件
vim /etc/nginx/nginx.conf
修改文件第一行的为静态文件的用户和组

# user 用户名 用户组  ; 这里的用户名和组就是静态文件的
user scott executor ;
</code></pre></td></tr></table>
</div>
</div><p>如果访问不了，关闭Ubuntu系统中的防火墙：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">1].防火墙，重启后生效：

开启：chkconfig iptables on 

关闭：chkconfig iptables off

2].防火墙，即时生效，重启后失效：

开启：service iptables start 

关闭：service iptables stop

3].ubuntu系统下：

关闭防火墙：ufw disable 

开启防火墙：ufw enable

再次访问就能成功了。
</code></pre></td></tr></table>
</div>
</div><p>常见的配置</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">    server <span class="o">{</span>
        listen       80<span class="p">;</span>
        server_name  localhost<span class="p">;</span>

        <span class="c1">#charset koi8-r;</span>

        <span class="c1">#access_log  logs/host.access.log  main;</span>

        location / <span class="o">{</span>
            <span class="c1">#root   html;</span>
            root   /home/webdemo/www/dist<span class="p">;</span>
            index  index.html index.htm<span class="p">;</span>
        <span class="o">}</span>

        <span class="c1">#error_page  404              /404.html;</span>

        <span class="c1"># redirect server error pages to the static page /50x.html</span>
        <span class="c1">#</span>
        error_page   <span class="m">500</span> <span class="m">502</span> <span class="m">503</span> <span class="m">504</span>  /50x.html<span class="p">;</span>
        <span class="nv">location</span> <span class="o">=</span> /50x.html <span class="o">{</span>
            root   html<span class="p">;</span>
        <span class="o">}</span>
        <span class="c1"># add by jeng, image server</span>
        location ^~/images/ <span class="o">{</span>
        <span class="nb">alias</span> /home/jeng/Projects/change_objects_api/results/<span class="p">;</span>
        autoindex on<span class="p">;</span>
        <span class="o">}</span>
	<span class="c1"># api 使用，映射到本地端口</span>
        location ^~/api/ <span class="o">{</span>
                proxy_pass http://127.0.0.1:8787/predict<span class="p">;</span>
        <span class="o">}</span>
        <span class="o">}</span>
        
</code></pre></td></tr></table>
</div>
</div><p>在centos 上设置开机自启（很重要的操作呀）</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">安装: yum install nginx
启动: systemctl start nginx
查看状态: systemctl status nginx
开机自启: systemctl <span class="nb">enable</span> nginx.service
</code></pre></td></tr></table>
</div>
</div><p><a href="https://www.cnblogs.com/zbzhm3728/articles/10407489.html">彻底删除CentOS上的Nginx方法</a></p>
<h3 id="nginx-实现上传功能">nginx 实现上传功能</h3>
<ol>
<li>安装 nginx-upload-module</li>
</ol>
<p>Nginx有一个Upload模块，可以非常简单的实现文件上传功能。此模块的原理是先把用户上传的文件保存到临时文件，然后在交由后台页面处理，并且把文件的原名，上传后的名称，文件类型，文件大小set到页面。</p>
<p>下载对应版本的 nginx （主要是想要有configure 文件）</p>
<p>下载file upload 的module地址：</p>
<p><a href="https://github.com/vkholodkov/nginx-upload-module">https://github.com/vkholodkov/nginx-upload-module</a></p>
<p>重新安装是最简单的事情，再之前的基础上进行二次安装是比较难的。</p>
<p>只能使用</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">make
</code></pre></td></tr></table>
</div>
</div><p>而不能使用</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">make <span class="p">&amp;</span> install
</code></pre></td></tr></table>
</div>
</div><p>（这样会重新安装）</p>
<p>关键是最后要替换新版本的 nginx</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback"># 备份
mv /data/services/nginx/sbin/nginx  /data/backup/nginx/nginx_$(date +%F)

# 更新
cp /data/packages/nginx/nginx-1.16.0/objs/nginx /data/services/nginx/sbin/

# 查看
/data/services/nginx/sbin/nginx -V
</code></pre></td></tr></table>
</div>
</div><p><a href="https://www.cnblogs.com/Dy1an/p/11227796.html">Nginx：编译安装/动态添加模块</a></p>
<ol start="2">
<li>nginx配置文件</li>
</ol>
<p>上传file 功能的具体配置参考如下的代码</p>
<p><a href="https://blog.csdn.net/zzhongcy/article/details/88863037">Nginx Upload Module 上传文件功能</a></p>
<p>在 <code>public/index.html</code> 文件中添加如下的内容</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">&lt;html&gt;&lt;body&gt;Hello World From The Frontend Container&lt;/body&gt;&lt;/html&gt;
</code></pre></td></tr></table>
</div>
</div><h3 id="常用的命令">常用的命令</h3>
<p>How to Start, Stop, or Restart Nginx</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">start: Starts the Nginx service.
stop: Terminates the Nginx service.
restart: Stops and then starts the Nginx service.
reload: Gracefully restarts the Nginx service. On reload, the main Nginx process shuts down the child processes, loads the new configuration, and starts new child processes.
status: Shows the service status.
</code></pre></td></tr></table>
</div>
</div><p>使用 Ubuntu 操作命令</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">sudo systemctl restart nginx

sudo /usr/sbin/nginx -s reload
sudo systemctl start nginx
sudo systemctl stop nginx
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="c1"># 查看进程</span>
ps aux <span class="p">|</span> grep nginx

<span class="c1">#  杀死进程</span>
sudo killall nginx
</code></pre></td></tr></table>
</div>
</div>
    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">jijeng</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
        2020-01-07
        
    </span>
  </p>
  
  
</div>
<div class="post-reward">
  <input type="checkbox" name="reward" id="reward" hidden />
  <label class="reward-button" for="reward">赞赏支持</label>
  <div class="qr-code">
    
    <label class="qr-code-image" for="reward">
        <img class="image" src="https://ftp.bmp.ovh/imgs/2020/12/a67dbe80ab6832ca.png">
        <span>微信打赏</span>
      </label>
    <label class="qr-code-image" for="reward">
        <img class="image" src="https://ftp.bmp.ovh/imgs/2020/12/b575cd4858bd404d.png">
        <span>支付宝打赏</span>
      </label>
  </div>
</div><footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/nginx/">nginx</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/git/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Git tutorial</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        <a class="next" href="/post/elastic_search_2/">
            <span class="next-text nav-default">Elasticsearch 的使用优化</span>
            <span class="next-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:your@email.com" class="iconfont icon-email" title="email"></a>
      <a href="http://localhost:1313" class="iconfont icon-github" title="github"></a>
      <a href="http://localhost:1313" class="iconfont icon-weibo" title="weibo"></a>
      <a href="http://localhost:1313" class="iconfont icon-bilibili" title="bilibili"></a>
  <a href="http://jijeng.github.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2018 - 
    2021<span class="heart"><i class="iconfont icon-heart"></i></span><span>jijeng</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c12618f9a600c40bd024996677e951e64d3487006775aeb22e200c990006c5c7.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
